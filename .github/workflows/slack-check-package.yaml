on:
  workflow_run:
    workflows: ["R-CMD-check"]
    types:
      - completed

name: slack-check-package

jobs:
  notify:
    runs-on: ubuntu-latest
    if: always()
    steps:
      - name: Send Slack message
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
          STATUS: ${{ github.event.workflow_run.conclusion }}
          REPO: ${{ github.repository }}
          URL: ${{ github.event.workflow_run.html_url }}
        run: |
          if [ -z "$SLACK_WEBHOOK_URL" ]; then
            echo "Missing SLACK_WEBHOOK_URL"; exit 1
          fi

          case "$STATUS" in
            success) ICON="‚úÖ";;
            failure) ICON="‚ùå";;
            cancelled) ICON="üü°";;
            *) ICON="‚ÑπÔ∏è";;
          esac

          message="${ICON} *R CMD check for \`${REPO}\` finished with status:* \`${STATUS}\`\n<${URL}|View on GitHub>"

          curl -X POST -H 'Content-type: application/json' \
            --data "{\"text\": \"$message\"}" \
            "$SLACK_WEBHOOK_URL"
