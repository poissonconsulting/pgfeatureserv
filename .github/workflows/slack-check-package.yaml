# on:
#   workflow_run:
#     workflows: ["R-CMD-check"]
#     types:
#       - completed
#
# name: slack-check-package
#
# jobs:
#   notify:
#     runs-on: ubuntu-latest
#     if: always()
#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v4
#
#       - name: Set up R
#         uses: r-lib/actions/setup-r@v2
#         with:
#           use-public-rspm: true
#
#       - name: Install dependencies
#         env:
#           GITHUB_PAT: ${{ secrets.PRIVATE_ACTIONS_PAT }}
#         run: |
#           install.packages("remotes")
#           remotes::install_github("poissonconsulting/poisslack")
#         shell: Rscript {0}
#
#       - name: Message associated Slack channel
#         env:
#           SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
#           REPO: ${{ github.repository }}
#           STATUS: ${{ github.event.workflow_run.conclusion }}
#           URL: ${{ github.event.workflow_run.html_url }}
#         run: |
#           status <- Sys.getenv("STATUS")
#           icon <- switch(
#             status,
#             success = "✅",
#             failure = "❌",
#             cancelled = "🚫",
#             "ℹ️"
#           )
#           poisslack::slackr_bot(
#             text = sprintf(
#               "%s R CMD check for `%s` **%s**\nView on GitHub: %s",
#               icon,
#               basename(Sys.getenv("REPO")),
#               toupper(status),
#               Sys.getenv("URL")
#             ),
#             channel = basename(Sys.getenv("REPO")),
#             username = "check-package-bot",
#             incoming_webhook_url = Sys.getenv("SLACK_WEBHOOK_URL")
#           )
#         shell: Rscript {0}
